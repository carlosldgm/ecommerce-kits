<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KitBox - Tu tienda de kits{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#4A90E2",
                        "background-light": "#F7FAFC",
                        "background-dark": "#1A202C",
                        "card-light": "#FFFFFF",
                        "card-dark": "#2D3748",
                        "text-light": "#2D3748",
                        "text-dark": "#E2E8F0",
                        "text-muted-light": "#718096",
                        "text-muted-dark": "#A0AEC0",
                    },
                    fontFamily: {
                        display: ["Poppins", "sans-serif"],
                    },
                },
            },
        };
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
        {% block extra_styles %}{% endblock %}
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark transition-colors duration-300">
    <header class="bg-card-light dark:bg-card-dark shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a class="text-2xl font-bold text-primary" href="/">
                KitBox
            </a>
            <div class="hidden md:flex items-center space-x-6">
                <a class="text-text-light dark:text-text-dark hover:text-primary dark:hover:text-primary transition-colors" href="/">Kits</a>
                <a class="text-text-light dark:text-text-dark hover:text-primary dark:hover:text-primary transition-colors" href="/kit/custom">Crear Kit</a>
            </div>
            <div class="flex items-center space-x-4">
                <button class="p-2 rounded-full text-text-muted-light dark:text-text-muted-dark hover:bg-gray-100 dark:hover:bg-gray-700" id="theme-toggle">
                    <span class="material-symbols-outlined" id="theme-icon">light_mode</span>
                </button>
                <!--
                <button class="bg-red-500 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-600 transition-colors" onclick="vaciarCarritoDesarrollo(); return false;">
                    üóëÔ∏è DEV
                </button>
                -->
                <a href="/carrito" class="bg-primary text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-colors flex items-center space-x-2">
                    <span class="material-symbols-outlined text-base">shopping_cart</span>
                    <span>Carrito (<span id="carrito-count">0</span>)</span>
                </a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-8">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-card-light dark:bg-card-dark mt-16">
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold text-primary mb-2">KitBox</h3>
                    <p class="text-text-muted-light dark:text-text-muted-dark">Tu caja de sorpresas, a tu medida.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-text-light dark:text-text-dark mb-2">Navegaci√≥n</h4>
                    <ul class="space-y-1 text-text-muted-light dark:text-text-muted-dark">
                        <li><a class="hover:text-primary" href="/">Kits</a></li>
                        <li><a class="hover:text-primary" href="/kit/custom">Crear Kit</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-text-light dark:text-text-dark mb-2">Contacto</h4>
                    <p class="text-text-muted-light dark:text-text-muted-dark">info@kitbox.com</p>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-200 dark:border-gray-700 pt-4 text-center text-text-muted-light dark:text-text-muted-dark text-sm">
                ¬© 2025 KitBox. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <script>
        async function actualizarCarrito() {
            try {
                const response = await fetch('/api/carrito');
                const data = await response.json();
                document.getElementById('carrito-count').textContent = data.total;
            } catch (error) {
                console.error('Error al actualizar carrito:', error);
            }
        }

        async function vaciarCarritoDesarrollo() {
            if (confirm('üö® DESARROLLO: ¬øVaciar todo el carrito?')) {
                try {
                    const response = await fetch('/api/carrito/limpiar', {
                        method: 'POST'
                    });
                    const data = await response.json();
                    if (data.success) {
                        await actualizarCarrito();
                        alert('‚úÖ Carrito vaciado');
                        if (window.location.pathname === '/carrito') {
                            location.reload();
                        }
                    }
                } catch (error) {
                    console.error('Error al vaciar carrito:', error);
                    alert('‚ùå Error al vaciar carrito');
                }
            }
        }

        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const htmlElement = document.documentElement;
        
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
            themeIcon.textContent = 'dark_mode';
        } else {
            htmlElement.classList.remove('dark');
            themeIcon.textContent = 'light_mode';
        }
        
        themeToggle.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
            if (htmlElement.classList.contains('dark')) {
                localStorage.setItem('theme', 'dark');
                themeIcon.textContent = 'dark_mode';
            } else {
                localStorage.setItem('theme', 'light');
                themeIcon.textContent = 'light_mode';
            }
        });

        actualizarCarrito();
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>